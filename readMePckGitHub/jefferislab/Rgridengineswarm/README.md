


<!DOCTYPE html>
<html lang="en" class="">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    
    
    <title>Rgridengineswarm/README.md at master · jefferislab/Rgridengineswarm · GitHub</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png">
    <meta property="fb:app_id" content="1401488693436528">

      <meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="jefferislab/Rgridengineswarm" name="twitter:title" /><meta content="Rgridengineswarm - Simple R tools for creating and managing swarms of workers on Grid Engine" name="twitter:description" /><meta content="https://avatars3.githubusercontent.com/u/5909263?v=3&amp;s=400" name="twitter:image:src" />
      <meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="https://avatars3.githubusercontent.com/u/5909263?v=3&amp;s=400" property="og:image" /><meta content="jefferislab/Rgridengineswarm" property="og:title" /><meta content="https://github.com/jefferislab/Rgridengineswarm" property="og:url" /><meta content="Rgridengineswarm - Simple R tools for creating and managing swarms of workers on Grid Engine" property="og:description" />
      <meta name="browser-stats-url" content="/_stats">
    <link rel="assets" href="https://assets-cdn.github.com/">
    
    <meta name="pjax-timeout" content="1000">
    

    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_source" data-pjax-transient>
      <meta name="google-analytics" content="UA-3769691-2">

    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="github" name="octolytics-app-id" /><meta content="C1BEC102:54B5:4E9AC9E:55103EF9" name="octolytics-dimension-request_id" />
    
    <meta content="Rails, view, blob#show" name="analytics-event" />

    
    <link rel="icon" type="image/x-icon" href="https://assets-cdn.github.com/favicon.ico">


    <meta content="authenticity_token" name="csrf-param" />
<meta content="hj2ZFH724RwpceUF7HyCvXwFjTrDV2b3zFMUR75qWOT9bAiYtLpXak46RddKkf5AcCeikHu0qGnfkzRwtvwzCg==" name="csrf-token" />

    <link href="https://assets-cdn.github.com/assets/github-099e0ecc2851c8aca89ef6dafa191df3b0f2a2c8ad34e134c5473ca1ba0a59b2.css" media="all" rel="stylesheet" />
    <link href="https://assets-cdn.github.com/assets/github2-1171344316fc088255ee2a06c271d14240f1a4e06985fe9e897762947872e858.css" media="all" rel="stylesheet" />
    
    


    <meta http-equiv="x-pjax-version" content="c0f32272c66bfb10ed7d46b7c88c6299">

      
  <meta name="description" content="Rgridengineswarm - Simple R tools for creating and managing swarms of workers on Grid Engine">
  <meta name="go-import" content="github.com/jefferislab/Rgridengineswarm git https://github.com/jefferislab/Rgridengineswarm.git">

  <meta content="5909263" name="octolytics-dimension-user_id" /><meta content="jefferislab" name="octolytics-dimension-user_login" /><meta content="14300275" name="octolytics-dimension-repository_id" /><meta content="jefferislab/Rgridengineswarm" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="false" name="octolytics-dimension-repository_is_fork" /><meta content="14300275" name="octolytics-dimension-repository_network_root_id" /><meta content="jefferislab/Rgridengineswarm" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/jefferislab/Rgridengineswarm/commits/master.atom" rel="alternate" title="Recent Commits to Rgridengineswarm:master" type="application/atom+xml">

  </head>


  <body class="logged_out  env-production  vis-public page-blob">
    <a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      


        
        <div class="header header-logged-out" role="banner">
  <div class="container clearfix">

    <a class="header-logo-wordmark" href="https://github.com/" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">
      <span class="mega-octicon octicon-logo-github"></span>
    </a>

    <div class="header-actions" role="navigation">
        <a class="btn btn-primary" href="/join" data-ga-click="(Logged out) Header, clicked Sign up, text:sign-up">Sign up</a>
      <a class="btn" href="/login?return_to=%2Fjefferislab%2FRgridengineswarm%2Fblob%2Fmaster%2FREADME.md" data-ga-click="(Logged out) Header, clicked Sign in, text:sign-in">Sign in</a>
    </div>

    <div class="site-search repo-scope js-site-search" role="search">
      <form accept-charset="UTF-8" action="/jefferislab/Rgridengineswarm/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/jefferislab/Rgridengineswarm/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
  <input type="text"
    class="js-site-search-field is-clearable"
    data-hotkey="s"
    name="q"
    placeholder="Search"
    data-global-scope-placeholder="Search GitHub"
    data-repo-scope-placeholder="Search"
    tabindex="1"
    autocapitalize="off">
  <div class="scope-badge">This repository</div>
</form>
    </div>

      <ul class="header-nav left" role="navigation">
          <li class="header-nav-item">
            <a class="header-nav-link" href="/explore" data-ga-click="(Logged out) Header, go to explore, text:explore">Explore</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/features" data-ga-click="(Logged out) Header, go to features, text:features">Features</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://enterprise.github.com/" data-ga-click="(Logged out) Header, go to enterprise, text:enterprise">Enterprise</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/blog" data-ga-click="(Logged out) Header, go to blog, text:blog">Blog</a>
          </li>
      </ul>

  </div>
</div>



      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    <div id="js-flash-container">
      
    </div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        
<ul class="pagehead-actions">

  <li>
      <a href="/login?return_to=%2Fjefferislab%2FRgridengineswarm"
    class="btn btn-sm btn-with-count tooltipped tooltipped-n"
    aria-label="You must be signed in to watch a repository" rel="nofollow">
    <span class="octicon octicon-eye"></span>
    Watch
  </a>
  <a class="social-count" href="/jefferislab/Rgridengineswarm/watchers">
    2
  </a>

  </li>

  <li>
      <a href="/login?return_to=%2Fjefferislab%2FRgridengineswarm"
    class="btn btn-sm btn-with-count tooltipped tooltipped-n"
    aria-label="You must be signed in to star a repository" rel="nofollow">
    <span class="octicon octicon-star"></span>
    Star
  </a>

    <a class="social-count js-social-count" href="/jefferislab/Rgridengineswarm/stargazers">
      1
    </a>

  </li>

    <li>
      <a href="/login?return_to=%2Fjefferislab%2FRgridengineswarm"
        class="btn btn-sm btn-with-count tooltipped tooltipped-n"
        aria-label="You must be signed in to fork a repository" rel="nofollow">
        <span class="octicon octicon-repo-forked"></span>
        Fork
      </a>
      <a href="/jefferislab/Rgridengineswarm/network" class="social-count">
        0
      </a>
    </li>
</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="mega-octicon octicon-repo"></span>
          <span class="author"><a href="/jefferislab" class="url fn" itemprop="url" rel="author"><span itemprop="title">jefferislab</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="/jefferislab/Rgridengineswarm" class="js-current-repository" data-pjax="#js-repo-pjax-container">Rgridengineswarm</a></strong>

          <span class="page-context-loader">
            <img alt="" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline  ">
        <div class="repository-sidebar clearfix">
            
<nav class="sunken-menu repo-nav js-repo-nav js-sidenav-container-pjax js-octicon-loaders"
     role="navigation"
     data-pjax="#js-repo-pjax-container"
     data-issue-count-url="/jefferislab/Rgridengineswarm/issues/counts">
  <ul class="sunken-menu-group">
    <li class="tooltipped tooltipped-w" aria-label="Code">
      <a href="/jefferislab/Rgridengineswarm" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-hotkey="g c" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches /jefferislab/Rgridengineswarm">
        <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

      <li class="tooltipped tooltipped-w" aria-label="Issues">
        <a href="/jefferislab/Rgridengineswarm/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g i" data-selected-links="repo_issues repo_labels repo_milestones /jefferislab/Rgridengineswarm/issues">
          <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
          <span class="js-issue-replace-counter"></span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>      </li>

    <li class="tooltipped tooltipped-w" aria-label="Pull requests">
      <a href="/jefferislab/Rgridengineswarm/pulls" aria-label="Pull requests" class="js-selected-navigation-item sunken-menu-item" data-hotkey="g p" data-selected-links="repo_pulls /jefferislab/Rgridengineswarm/pulls">
          <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull requests</span>
          <span class="js-pull-replace-counter"></span>
          <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>


  </ul>
  <div class="sunken-menu-separator"></div>
  <ul class="sunken-menu-group">

    <li class="tooltipped tooltipped-w" aria-label="Pulse">
      <a href="/jefferislab/Rgridengineswarm/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-selected-links="pulse /jefferislab/Rgridengineswarm/pulse">
        <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>

    <li class="tooltipped tooltipped-w" aria-label="Graphs">
      <a href="/jefferislab/Rgridengineswarm/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-selected-links="repo_graphs repo_contributors /jefferislab/Rgridengineswarm/graphs">
        <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
        <img alt="" class="mini-loader" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-e513294efa576953719e4e2de888dd9cf929b7d62ed8d05f25e731d02452ab6c.gif" width="16" />
</a>    </li>
  </ul>


</nav>

              <div class="only-with-full-nav">
                  
<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><span class="text-emphasized">HTTPS</span> clone URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="https://github.com/jefferislab/Rgridengineswarm.git" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>

  
<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><span class="text-emphasized">Subversion</span> checkout URL</h3>
  <div class="input-group js-zeroclipboard-container">
    <input type="text" class="input-mini input-monospace js-url-field js-zeroclipboard-target"
           value="https://github.com/jefferislab/Rgridengineswarm" readonly="readonly">
    <span class="input-group-button">
      <button aria-label="Copy to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
    </span>
  </div>
</div>



<p class="clone-options">You can clone with
  <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a> or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <a href="https://help.github.com/articles/which-remote-url-should-i-use" class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <span class="octicon octicon-question"></span>
  </a>
</p>



                <a href="/jefferislab/Rgridengineswarm/archive/master.zip"
                   class="btn btn-sm sidebar-button"
                   aria-label="Download the contents of jefferislab/Rgridengineswarm as a zip file"
                   title="Download the contents of jefferislab/Rgridengineswarm as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          

<a href="/jefferislab/Rgridengineswarm/blob/4706abf54015c0b209092f8276c57c20f6ff6053/README.md" class="hidden js-permalink-shortcut" data-hotkey="y">Permalink</a>

<!-- blob contrib key: blob_contributors:v21:8ba5696289eb94651d03117fd21a2bde -->

<div class="file-navigation js-zeroclipboard-container">
  
<div class="select-menu js-menu-container js-select-menu left">
  <span class="btn btn-sm select-menu-button js-menu-target css-truncate" data-hotkey="w"
    data-master-branch="master"
    data-ref="master"
    title="master"
    role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button css-truncate-target">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-x js-menu-close" role="button" aria-label="Close"></span>
      </div>

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" data-filter-placeholder="Filter branches/tags" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" data-filter-placeholder="Find a tag…" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <a class="select-menu-item js-navigation-item js-navigation-open selected"
               href="/jefferislab/Rgridengineswarm/blob/master/README.md"
               data-name="master"
               data-skip-pjax="true"
               rel="nofollow">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <span class="select-menu-item-text css-truncate-target" title="master">
                master
              </span>
            </a>
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div>

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div>

    </div>
  </div>
</div>

  <div class="btn-group right">
    <a href="/jefferislab/Rgridengineswarm/find/master"
          class="js-show-file-finder btn btn-sm empty-icon tooltipped tooltipped-s"
          data-pjax
          data-hotkey="t"
          aria-label="Quickly jump between files">
      <span class="octicon octicon-list-unordered"></span>
    </a>
    <button aria-label="Copy file path to clipboard" class="js-zeroclipboard btn btn-sm zeroclipboard-button" data-copied-hint="Copied!" type="button"><span class="octicon octicon-clippy"></span></button>
  </div>

  <div class="breadcrumb js-zeroclipboard-target">
    <span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/jefferislab/Rgridengineswarm" class="" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">Rgridengineswarm</span></a></span></span><span class="separator">/</span><strong class="final-path">README.md</strong>
  </div>
</div>

<include-fragment class="commit commit-loader file-history-tease" src="/jefferislab/Rgridengineswarm/contributors/master/README.md">
  <div class="file-history-tease-header">
    Fetching contributors&hellip;
  </div>

  <div class="participation">
    <p class="loader-loading"><img alt="" height="16" src="https://assets-cdn.github.com/assets/spinners/octocat-spinner-32-EAF2F5-0bdc57d34b85c4a4de9d0d1db10cd70e8a95f33ff4f46c5a8c48b4bf4e5a9abe.gif" width="16" /></p>
    <p class="loader-error">Cannot retrieve contributors at this time</p>
  </div>
</include-fragment>
<div class="file">
  <div class="file-header">
    <div class="file-actions">

      <div class="btn-group">
        <a href="/jefferislab/Rgridengineswarm/raw/master/README.md" class="btn btn-sm " id="raw-url">Raw</a>
          <a href="/jefferislab/Rgridengineswarm/blame/master/README.md" class="btn btn-sm js-update-url-with-hash">Blame</a>
        <a href="/jefferislab/Rgridengineswarm/commits/master/README.md" class="btn btn-sm " rel="nofollow">History</a>
      </div>


          <button type="button" class="octicon-btn disabled tooltipped tooltipped-n" aria-label="You must be signed in to make or propose changes">
            <span class="octicon octicon-pencil"></span>
          </button>

        <button type="button" class="octicon-btn octicon-btn-danger disabled tooltipped tooltipped-n" aria-label="You must be signed in to make or propose changes">
          <span class="octicon octicon-trashcan"></span>
        </button>
    </div>

    <div class="file-info">
        202 lines (164 sloc)
        <span class="file-info-divider"></span>
      9.321 kb
    </div>
  </div>
    <div id="readme" class="blob instapaper_body">
    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a id="user-content-r-grid-engine-worker-swarm-control" class="anchor" href="#r-grid-engine-worker-swarm-control" aria-hidden="true"><span class="octicon octicon-link"></span></a>R Grid Engine worker swarm control</h1>

<h2>
<a id="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>This simple package controls a swarm of workers, running on a <a href="http://gridscheduler.sourceforge.net">Grid Engine</a> pool, using a MySQL database to store information about jobs. Functions are provided to add workers to a job after the initial workers have been set working.</p>

<p>Grid Engine has its own terminology with which we have tried to avoid collisions. We define a <em>job</em> as a set of <em>chunks</em> of work that are to be completed by a <em>swarm</em> of <em>workers</em>. Each worker runs a copy of a script that requests chunks of work from the MySQL database and processes them. These workers may be distributed across multiple Grid Engine <em>tasks</em>, although workers added to the swarm at the same point will have the same Grid Engine task ID, each in a different <em>slot</em>. Workers may be placed on separate CPUs within the same <em>host</em> or on different hosts as Grid Engine sees fit.</p>

<h2>
<a id="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Installation of the latest version from github can be achieved using Hadley Wickham's <a href="https://github.com/hadley/devtools">devtools</a> package:</p>

<div class="highlight highlight-r"><pre>install.packages(<span class="pl-s"><span class="pl-pds">"</span>devtools<span class="pl-pds">"</span></span>)
library(<span class="pl-smi">devtools</span>)
install_github(<span class="pl-s"><span class="pl-pds">"</span>Rgridengineswarm<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>jefferislab<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="user-content-configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>By default, the details of the database connection are read from the <code>Rgridengineswarm</code> group in the current user's <code>.my.cnf</code> (usually located at <code>$HOME/.my.cnf</code>). Here is an example of what this might look like:</p>

<pre><code>[Rgridengineswarm]
database = jobcontrol
user = fred
password = supersecure
host = 127.0.0.1
</code></pre>

<p>See the <a href="http://dev.mysql.com/doc/refman/5.1/en/option-files.html">mysql documentation</a> for further details.</p>

<p>A different group can be passed to the <code>.jobcontrol_connection</code> function or, if you do not want to use the <code>.my.cnf</code> file, the function can be overloaded, e.g.:</p>

<div class="highlight highlight-r"><pre><span class="pl-en">.jobcontrol_connection</span> <span class="pl-k">&lt;-</span> <span class="pl-k">function</span>(<span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-c1">NULL</span>, <span class="pl-v">user</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>fred<span class="pl-pds">'</span></span>, <span class="pl-v">password</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>supersecure<span class="pl-pds">'</span></span>, <span class="pl-v">dbname</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>jobcontrol<span class="pl-pds">'</span></span>, <span class="pl-v">host</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>127.0.0.1<span class="pl-pds">'</span></span>, <span class="pl-k">...</span>){
  dbConnect(MySQL(), <span class="pl-v">user</span><span class="pl-k">=</span><span class="pl-smi">user</span>, <span class="pl-v">password</span><span class="pl-k">=</span><span class="pl-smi">password</span>, <span class="pl-v">dbname</span><span class="pl-k">=</span><span class="pl-smi">dbname</span>, <span class="pl-v">host</span><span class="pl-k">=</span><span class="pl-smi">host</span>, <span class="pl-k">...</span>)
}</pre></div>

<h3>
<a id="user-content-setting-up-the-mysql-database" class="anchor" href="#setting-up-the-mysql-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up the MySQL database</h3>

<h4>
<a id="user-content-creating-the-table-structure" class="anchor" href="#creating-the-table-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating the table structure</h4>

<p>The following SQL will create a table with the appropriate name and structure for the default configuration of the package. Note that the <code>stuff_to_do</code> field is merely a container for arbitrary data --- it is up to the worker script to determine how to handle the data returned.</p>

<pre><code>DELIMITER $$

CREATE TABLE `chunks` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `status` int(11) NOT NULL COMMENT '0 available, 1 running, 2 done, -1 error',
  `worker_id` int(11) DEFAULT NULL,
  `worker_name` varchar(255) DEFAULT NULL,
  `stuff_to_do` varchar(255) DEFAULT NULL,
  `job_id` int(11) NOT NULL,
  `chunk_created` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `chunk_run` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_UNIQUE` (`id`),
  KEY `job_id_asc` (`job_id`)
) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=latin1$$
</code></pre>

<h4>
<a id="user-content-routines" class="anchor" href="#routines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Routines</h4>

<p>Concurrent writes to the MySQL database are prevented by routines specified in the database definition. These are defined to prevent workers from trying to access the database while another worker is editing it. They are specified as follows:</p>

<h5>
<a id="user-content-get_chunk" class="anchor" href="#get_chunk" aria-hidden="true"><span class="octicon octicon-link"></span></a>get_chunk</h5>

<pre><code>DELIMITER $$

CREATE DEFINER=`root`@`localhost` FUNCTION `get_chunk`(_worker_id INT, _job_id INT, _worker_name VARCHAR(255)) RETURNS int(11)
BEGIN
DECLARE chunk_id INT DEFAULT -1;
SET chunk_id=next_chunk(_job_id);
IF chunk_id&gt;=0 THEN
    UPDATE chunks SET worker_id=_worker_id,status=1,chunk_run=CURRENT_TIMESTAMP,worker_name=_worker_name WHERE id=chunk_id;
END IF;
RETURN chunk_id;
END
</code></pre>

<h5>
<a id="user-content-next_chunk" class="anchor" href="#next_chunk" aria-hidden="true"><span class="octicon octicon-link"></span></a>next_chunk</h5>

<pre><code>DELIMITER $$

CREATE DEFINER=`root`@`localhost` FUNCTION `next_chunk`(_job_id INT) RETURNS int(11)
BEGIN
DECLARE chunk_id INT DEFAULT -1;
SELECT id FROM chunks where status=0 AND job_id=_job_id ORDER BY id ASC LIMIT 1 INTO chunk_id;
RETURN chunk_id;
END
</code></pre>

<h5>
<a id="user-content-set_chunk_done" class="anchor" href="#set_chunk_done" aria-hidden="true"><span class="octicon octicon-link"></span></a>set_chunk_done</h5>

<pre><code>DELIMITER $$

CREATE DEFINER=`root`@`localhost` FUNCTION `set_chunk_done`(_worker_id INT, _job_id INT, _chunk_id INT) RETURNS int(11)
BEGIN
DECLARE chunk_id INT DEFAULT -1;
UPDATE chunks SET status=2 WHERE id=_chunk_id AND worker_id=_worker_id AND job_id=_job_id;
SELECT id FROM chunks where status=2 AND id=_chunk_id AND job_id=_job_id AND worker_id=_worker_id ORDER BY id ASC LIMIT 1 INTO chunk_id;
RETURN chunk_id;
END
</code></pre>

<h2>
<a id="user-content-usage-examples" class="anchor" href="#usage-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage examples</h2>

<h3>
<a id="user-content-creating-jobs" class="anchor" href="#creating-jobs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating jobs</h3>

<p>As a simple example, this script creates a record of a job in the MySQL database, consisting of 50 chunks of work. The script below can then be run to start workers processing the job.</p>

<div class="highlight highlight-r"><pre><span class="pl-c">#!/usr/bin/env Rscript</span>
library(<span class="pl-smi">Rgridengineswarm</span>)

<span class="pl-c"># Set the job id</span>
<span class="pl-smi">jobid</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">201</span>

<span class="pl-c"># Clear any old jobs with this id and create a new job of 50 chunks</span>
delete_job(<span class="pl-smi">jobid</span>)
create_chunk(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">50</span>, <span class="pl-v">job_id</span><span class="pl-k">=</span><span class="pl-smi">jobid</span>)</pre></div>

<h3>
<a id="user-content-a-dumb-swarm-of-workers" class="anchor" href="#a-dumb-swarm-of-workers" aria-hidden="true"><span class="octicon octicon-link"></span></a>A 'dumb' swarm of workers</h3>

<p>This script queries the database to obtain the details of a chunk, marks the chunk as done and repeats until there are no chunks left to work on.</p>

<div class="highlight highlight-r"><pre><span class="pl-c">#!/usr/bin/env Rscript</span>
library(<span class="pl-smi">Rgridengineswarm</span>)

<span class="pl-c"># Set worker id</span>
<span class="pl-smi">workerid</span> <span class="pl-k">&lt;-</span> as.numeric(Sys.getenv(<span class="pl-s"><span class="pl-pds">"</span>SGE_TASK_ID<span class="pl-pds">"</span></span>))

<span class="pl-smi">i</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">0</span>
<span class="pl-v">jccon</span><span class="pl-k">=</span>.jobcontrol_connection()
<span class="pl-k">while</span>(<span class="pl-k">!</span>all(is.na(<span class="pl-smi">chunk</span> <span class="pl-k">&lt;-</span> get_chunk(<span class="pl-v">worker_id</span><span class="pl-k">=</span><span class="pl-smi">workerid</span>, <span class="pl-v">job_id</span><span class="pl-k">=</span><span class="pl-smi">jobid</span>, <span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-smi">jccon</span>)))){
  message(<span class="pl-s"><span class="pl-pds">"</span>Working on chunk <span class="pl-pds">"</span></span>, <span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">stuff_to_do</span>)
  <span class="pl-smi">i</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">i</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>
  <span class="pl-k">if</span>(<span class="pl-k">!</span>set_chunk_done(<span class="pl-v">worker_id</span><span class="pl-k">=</span><span class="pl-smi">workerid</span>, <span class="pl-v">job_id</span><span class="pl-k">=</span><span class="pl-smi">jobid</span>, <span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-smi">jccon</span>, <span class="pl-v">chunk_id</span><span class="pl-k">=</span><span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">id</span>)) message(<span class="pl-s"><span class="pl-pds">"</span>Failed to set chunk <span class="pl-pds">"</span></span>, <span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">id</span>, <span class="pl-s"><span class="pl-pds">"</span> done.<span class="pl-pds">"</span></span>)
}
message(<span class="pl-s"><span class="pl-pds">"</span>Finished <span class="pl-pds">"</span></span>, <span class="pl-smi">i</span>, <span class="pl-s"><span class="pl-pds">"</span> chunks!<span class="pl-pds">"</span></span>)</pre></div>

<p>This swarm can be submitted to Grid Engine using <code>qsub -t 1:&lt;num_workers&gt; -b yes -cwd example_prime_worker.R</code>, where <code>&lt;num_workers&gt;</code> should be set to the number of workers you wish to work on the job. Since gridengine spews out a bunch of log files in the working directory it normally makes sense to make a special folder to hold them. I normally do something like this:</p>

<div class="highlight highlight-sh"><pre><span class="pl-c1">cd</span> path/to/my/project
mkdir sgelogs
<span class="pl-c1">cd</span> sgelogs
qsub -t 1:<span class="pl-k">&lt;</span>num_workers<span class="pl-k">&gt;</span> -b yes -cwd path/to/example_prime_worker.R</pre></div>

<p>Once running, more workers can be added to the swarm by running a new <code>qsub</code> command, but the swarm will not manage its size automatically. For a swarm you can set running and leave to manage itself, see the next example.</p>

<h3>
<a id="user-content-a-self-updating-swarm-of-workers" class="anchor" href="#a-self-updating-swarm-of-workers" aria-hidden="true"><span class="octicon octicon-link"></span></a>A self-updating swarm of workers</h3>

<p>In this more advanced example, a swarm of workers is initialised and periodically checks the number of CPUs available in the Grid Engine pool to see if the size of the swarm can be increased. To do this, a 'prime worker' is assigned the task of setting up the job records in the MySQL database as well as submitting new requests to Grid Engine to alter the swarm size.</p>

<div class="highlight highlight-r"><pre><span class="pl-c">#!/usr/bin/env Rscript</span>
library(<span class="pl-smi">Rgridengineswarm</span>)
library(<span class="pl-smi">digest</span>)

<span class="pl-c"># Job data</span>
<span class="pl-smi">jobid</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">401</span>
<span class="pl-smi">workerid</span> <span class="pl-k">&lt;-</span> as.numeric(Sys.getenv(<span class="pl-s"><span class="pl-pds">"</span>SGE_TASK_ID<span class="pl-pds">"</span></span>))
<span class="pl-smi">workername</span> <span class="pl-k">&lt;-</span> paste0(system(<span class="pl-s"><span class="pl-pds">"</span>hostname<span class="pl-pds">"</span></span>, <span class="pl-v">intern</span><span class="pl-k">=</span><span class="pl-c1">T</span>), <span class="pl-s"><span class="pl-pds">"</span>:<span class="pl-pds">"</span></span>, <span class="pl-smi">workerid</span>)
<span class="pl-smi">numChunks</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">100</span>
<span class="pl-smi">cpusToLeave</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">70</span>
<span class="pl-smi">workerScript</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>example_prime_worker.R<span class="pl-pds">"</span></span>

<span class="pl-c"># Open connection to database</span>
<span class="pl-smi">jccon</span> <span class="pl-k">&lt;-</span> .jobcontrol_connection()

<span class="pl-c"># Log which id the worker claims to have</span>
message(<span class="pl-s"><span class="pl-pds">"</span>I am worker <span class="pl-pds">"</span></span>, <span class="pl-smi">workerid</span>, <span class="pl-s"><span class="pl-pds">"</span> (<span class="pl-pds">"</span></span>, <span class="pl-smi">workername</span>, <span class="pl-s"><span class="pl-pds">"</span>).<span class="pl-pds">"</span></span>)

<span class="pl-c"># Check if this worker should set up chunks, or wait for them to be set up</span>
<span class="pl-k">if</span>(<span class="pl-smi">workerid</span> <span class="pl-k">==</span> <span class="pl-c1">1</span>) {
    <span class="pl-c"># This worker is the prime worker, so set up the chunks in the job</span>
    message(<span class="pl-s"><span class="pl-pds">"</span>Setting up <span class="pl-pds">"</span></span>, <span class="pl-smi">numChunks</span>, <span class="pl-s"><span class="pl-pds">"</span> chunks for job <span class="pl-pds">"</span></span>, <span class="pl-smi">jobid</span>, <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>)

    <span class="pl-c"># Delete any old listings for the same job id and create chunks</span>
    delete_job(<span class="pl-smi">jobid</span>, <span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-smi">jccon</span>)
    create_chunk(unlist(lapply(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-smi">numChunks</span>, <span class="pl-smi">digest</span>)), <span class="pl-v">job_id</span><span class="pl-k">=</span><span class="pl-smi">jobid</span>, <span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-smi">jccon</span>)

    <span class="pl-c"># Try and add some more workers now that the job is stored in the MySQL database</span>
    consider_adding_workers(<span class="pl-smi">cpusToLeave</span>, <span class="pl-smi">workerScript</span>, <span class="pl-v">availabilityDivisor</span><span class="pl-k">=</span><span class="pl-c1">3</span>)
}

<span class="pl-c"># Work on chunks</span>
<span class="pl-smi">chunksCompleted</span> <span class="pl-k">&lt;-</span> <span class="pl-c1">0</span>
<span class="pl-k">while</span>(<span class="pl-k">!</span>all(is.na(<span class="pl-smi">chunk</span> <span class="pl-k">&lt;-</span> get_chunk(<span class="pl-v">worker_id</span><span class="pl-k">=</span><span class="pl-smi">workerid</span>, <span class="pl-v">worker_name</span><span class="pl-k">=</span><span class="pl-smi">workername</span>, <span class="pl-v">job_id</span><span class="pl-k">=</span><span class="pl-smi">jobid</span>, <span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-smi">jccon</span>)))) {
    message(<span class="pl-s"><span class="pl-pds">"</span>Working on chunk <span class="pl-pds">"</span></span>, <span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">id</span>, <span class="pl-s"><span class="pl-pds">"</span> (belongs to job <span class="pl-pds">"</span></span>, <span class="pl-smi">jobid</span>, <span class="pl-s"><span class="pl-pds">"</span>), doing <span class="pl-pds">"</span></span>, <span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">stuff_to_do</span>, <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>)

    <span class="pl-c"># Our chunks don't correspond to any actual work, so we sleep for some some time to simulate the act of doing work</span>
    Sys.sleep(floor(runif(<span class="pl-c1">1</span>, <span class="pl-c1">50</span>, <span class="pl-c1">100</span>)))
    <span class="pl-smi">chunksCompleted</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">chunksCompleted</span> <span class="pl-k">+</span> <span class="pl-c1">1</span>
    <span class="pl-k">if</span>(<span class="pl-k">!</span>set_chunk_done(<span class="pl-v">worker_id</span><span class="pl-k">=</span><span class="pl-smi">workerid</span>, <span class="pl-v">job_id</span><span class="pl-k">=</span><span class="pl-smi">jobid</span>, <span class="pl-v">con</span><span class="pl-k">=</span><span class="pl-smi">jccon</span>, <span class="pl-v">chunk_id</span><span class="pl-k">=</span><span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">id</span>)) message(<span class="pl-s"><span class="pl-pds">"</span>Failed to set chunk <span class="pl-pds">"</span></span>, <span class="pl-smi">chunk</span><span class="pl-k">$</span><span class="pl-smi">id</span>, <span class="pl-s"><span class="pl-pds">"</span> done.<span class="pl-pds">"</span></span>)

    <span class="pl-c"># Check to see if we can spawn more workers</span>
    <span class="pl-k">if</span> (<span class="pl-smi">workerid</span> <span class="pl-k">==</span> <span class="pl-c1">1</span>) {
        <span class="pl-k">if</span> (<span class="pl-smi">chunksCompleted</span> <span class="pl-k">%%</span> <span class="pl-c1">5</span> <span class="pl-k">==</span> <span class="pl-c1">0</span>) {
            consider_adding_workers(<span class="pl-smi">cpusToLeave</span>, <span class="pl-smi">workerScript</span>, <span class="pl-v">availabilityDivisor</span><span class="pl-k">=</span><span class="pl-c1">3</span>)
        }
    }
}
message(<span class="pl-s"><span class="pl-pds">"</span>Finished <span class="pl-pds">"</span></span>, <span class="pl-smi">chunksCompleted</span>, <span class="pl-s"><span class="pl-pds">"</span> chunks!<span class="pl-pds">"</span></span>)</pre></div>

<p>Assuming this Rscript is saved as <code>example_prime_worker.R</code>, the swarm can be initialised with <code>qsub -t 1:1 -b yes -cwd example_prime_worker.R</code>. This will create an initial worker that will dutifully set up the details of the job in the MySQL database. After this, it will try and add more workers to the job and start work on a chunk itself. After it has completed a few chunks, it will again check to see if more workers can be added to the job. This process repeats until there are no more chunks to start working on. It is possible for chunk to be started, but not completed, in which case the status will be set to 1 (0 and 2 indicate unstarted and completed jobs, respectively) --- in this situation the MySQL database should be inspected and the status of the incomplete jobs set to 0 or 2, as appropriate, with the swarm being started again if necessary.</p>
</article>
  </div>

</div>

<a href="#jump-to-line" rel="facebox[.linejump]" data-hotkey="l" style="display:none">Jump to Line</a>
<div id="jump-to-line" style="display:none">
  <form accept-charset="UTF-8" class="js-jump-to-line-form">
    <input class="linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" autofocus>
    <button type="submit" class="btn">Go</button>
  </form>
</div>

        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer" role="contentinfo">
    <ul class="site-footer-links right">
        <li><a href="https://status.github.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
      <li><a href="https://developer.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
      <li><a href="https://shop.github.com" data-ga-click="Footer, go to shop, text:shop">Shop</a></li>
        <li><a href="https://github.com/blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a href="https://github.com/about" data-ga-click="Footer, go to about, text:about">About</a></li>

    </ul>

    <a href="https://github.com" aria-label="Homepage">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
</a>
    <ul class="site-footer-links">
      <li>&copy; 2015 <span title="0.04048s from github-fe121-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms" data-ga-click="Footer, go to terms, text:terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy" data-ga-click="Footer, go to privacy, text:privacy">Privacy</a></li>
        <li><a href="https://github.com/security" data-ga-click="Footer, go to security, text:security">Security</a></li>
        <li><a href="https://github.com/contact" data-ga-click="Footer, go to contact, text:contact">Contact</a></li>
    </ul>
  </div>
</div>


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-suggester-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents" placeholder=""></textarea>
      <div class="suggester-container">
        <div class="suggester fullscreen-suggester js-suggester js-navigation-container"></div>
      </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    
    

    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-x flash-close js-ajax-error-dismiss" aria-label="Dismiss error"></a>
      Something went wrong with that request. Please try again.
    </div>


      <script crossorigin="anonymous" src="https://assets-cdn.github.com/assets/frameworks-d22b59d0085e83b7549ba4341ec9e68f80c2f29c8e49213ee182003dc8d568c6.js"></script>
      <script async="async" crossorigin="anonymous" src="https://assets-cdn.github.com/assets/github-0bc0f45c838b5d9d25bc071d2a4b0abe759a093392087dce55cd2caa00ea4f36.js"></script>
      
      

  </body>
</html>

